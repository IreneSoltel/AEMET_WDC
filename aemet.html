<!DOCTYPE html>
<html>
<head>
    <title>AEMET Data Connector</title>
    <meta http-equiv="Cache-Control" content="no-store" />
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js" type="text/javascript"></script>
    <script src="aemet.js" type="text/javascript"></script>
    <style>
        .vertical-center-row {
            display: flex;
            align-items: center;
            min-height: 80vh;
        }
        #testResults {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        pre {
            max-height: 200px;
            overflow-y: auto;
        }
        .action-buttons {
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row vertical-center-row">
            <div class="col-md-8 col-md-offset-2">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h2 class="panel-title">AEMET Data Connector</h2>
                    </div>
                    <div class="panel-body">
                        <form>
                            <div class="form-group">
                                <label for="apiKey">API Key AEMET</label>
                                <input type="text" class="form-control" id="apiKey" placeholder="Introduce tu API Key de AEMET">
                                <small class="help-block">Obtén tu API Key en <a href="https://opendata.aemet.es/centrodedescargas/inicio" target="_blank">AEMET OpenData</a></small>
                            </div>
                            <div class="form-group">
                                <label for="dataType">Tipo de Datos</label>
                                <select class="form-control" id="dataType">
                                    <option value="estaciones">Estaciones Meteorológicas</option>
                                    <option value="prediccion">Predicción diaria por municipio</option>
                                    <option value="observacion">Datos de observación</option>
                                </select>
                            </div>
                            <div class="form-group" id="municipioGroup" style="display:none;">
                                <label for="codigoMunicipio">Código de Municipio (solo para predicción)</label>
                                <input type="text" class="form-control" id="codigoMunicipio" placeholder="Ej: 28079 para Madrid" value="28079">
                                <small class="help-block">Consulta los códigos en <a href="https://www.ine.es/daco/daco42/codmun/codmun21/21codmun.xlsx" target="_blank">INE</a></small>
                            </div>
                            <div class="action-buttons">
                                <div class="row">
                                    <div class="col-md-6">
                                        <button type="button" id="testButton" class="btn btn-success btn-block">Probar API</button>
                                    </div>
                                    <div class="col-md-6">
                                        <button type="button" id="submitButton" class="btn btn-primary btn-block">Obtener Datos AEMET</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        
                        <!-- Área para mostrar resultados de prueba -->
                        <div id="testResults" style="display: none;"></div>
                        
                        <div class="alert alert-info mt-3" style="margin-top: 20px;">
                            <p><strong>Información:</strong></p>
                            <ul>
                                <li>Este conector permite obtener datos meteorológicos de AEMET para usar en Tableau.</li>
                                <li>Para hacer pruebas, usa el botón "Probar API".</li>
                                <li>Para enviar datos a Tableau, usa "Obtener Datos AEMET".</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Script para mostrar/ocultar secciones
        $(document).ready(function() {
            // Mostrar área de resultados cuando se hace clic en Probar API
            $("#testButton").click(function() {
                $("#testResults").show();
            });
        });
    </script>
</body>
</html>